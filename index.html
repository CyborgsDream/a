<!--
@project: a — alpha workspace (Metrix multi-app hub)
@version: v0.1.0
@date: 2025-11-04 (Europe/Warsaw)
@blurb: Static HTML5 hub listing mini-apps via projects.json. Shared code via /shared/vX import maps. No server-side code.
-->
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>a — alpha workspace</title>
<style>
:root{
  --bg:#011627;
  --bezel:#0b2236;
  --screen:#052a42;
  --glow:rgba(96,255,230,.12);
  --fg:#b9ffe3;
  --muted:#7dc2ad;
  --accent:#6af7ff;
  --alert:#f5f094;
  --font:"IBM Plex Mono","VT323","Fira Mono","Courier New",monospace;
}
*{box-sizing:border-box}
html,body{margin:0;min-height:100%;background:var(--bg);color:var(--fg);font:15px/1.5 var(--font);text-transform:uppercase;letter-spacing:.08em}
body{display:flex;align-items:center;justify-content:center;padding:20px}
.bezel{width:clamp(320px,96vw,1180px);background:var(--bezel);border:3px solid #0d324b;box-shadow:0 18px 36px rgba(0,0,0,.6),0 0 0 4px #04131f inset;border-radius:14px;padding:10px}
.screen{background:radial-gradient(circle at 50% 20%,var(--glow),transparent 45%),var(--screen);border:2px solid #0a3d58;border-radius:8px;box-shadow:0 0 24px rgba(0,0,0,.8) inset;aspect-ratio:19/6;min-height:360px;display:flex;flex-direction:column;padding:12px 14px;gap:10px;overflow:hidden;position:relative}
.screen::after{content:"";position:absolute;inset:0;background:repeating-linear-gradient(0deg,rgba(255,255,255,.05) 0 2px,transparent 2px 4px);mix-blend-mode:screen;opacity:.25;pointer-events:none}
.masthead{display:flex;flex-direction:column;gap:4px;border-bottom:1px solid rgba(255,255,255,.15);padding-bottom:6px}
.masthead__title{display:flex;gap:10px;align-items:center;font-size:17px;color:var(--accent)}
.masthead__title span{display:inline-block;background:rgba(0,0,0,.2);padding:2px 6px;border:1px solid var(--accent);box-shadow:0 0 8px var(--glow) inset;font-weight:700}
.masthead__meta{color:var(--muted);font-size:12px;letter-spacing:.12em}
.status-line{display:flex;gap:8px;font-size:12px;color:var(--alert)}
.controls{display:grid;grid-template-columns:1fr;gap:6px;padding:6px 0;border-bottom:1px solid rgba(255,255,255,.12)}
.menu{display:flex;flex-wrap:wrap;gap:8px;align-items:center}
.menu__item{appearance:none;border:1px solid rgba(255,255,255,.2);background:transparent;color:var(--fg);padding:4px 8px;font:inherit;cursor:pointer;letter-spacing:.12em;transition:background .15s ease,color .15s ease;border-radius:4px;box-shadow:0 0 0 1px rgba(0,0,0,.35) inset}
.menu__item:hover{background:rgba(255,255,255,.08)}
.menu__item.is-active{background:rgba(106,247,255,.15);color:var(--accent);border-color:var(--accent)}
.search{display:flex;align-items:center;gap:8px}
.search span{color:var(--alert);font-size:12px}
.search input{flex:1;appearance:none;background:rgba(0,0,0,.18);border:1px solid rgba(255,255,255,.24);color:var(--fg);padding:6px 8px;font:inherit;letter-spacing:.12em;text-transform:uppercase;outline:none;border-radius:4px;box-shadow:0 0 0 1px rgba(0,0,0,.5) inset}
.search input:focus{border-color:var(--accent);box-shadow:0 0 0 1px rgba(0,0,0,.5) inset,0 0 0 2px rgba(106,247,255,.4)}
main{flex:1;overflow:auto;display:flex;flex-direction:column;gap:10px;padding:6px 2px}
.program{background:rgba(0,0,0,.12);border:1px solid rgba(255,255,255,.16);padding:8px 10px;border-radius:6px;box-shadow:0 6px 18px rgba(0,0,0,.35) inset,0 0 0 1px rgba(0,0,0,.4) inset;display:grid;gap:4px;position:relative}
.program::before{content:"◼";position:absolute;left:6px;top:8px;color:var(--accent);opacity:.8;font-size:10px}
.program__header{display:flex;justify-content:space-between;gap:10px;color:var(--accent);font-weight:700}
.program__meta{font-size:11px;color:var(--muted);letter-spacing:.1em}
.program__desc{font-size:13px;color:var(--fg);text-transform:none;letter-spacing:.02em}
.program__tags{display:flex;flex-wrap:wrap;gap:6px;font-size:10px;color:var(--accent)}
.program__link{justify-self:end;text-decoration:none;color:var(--alert);padding:4px 6px;border:1px solid rgba(245,240,148,.6);border-radius:4px;background:rgba(245,240,148,.08);letter-spacing:.16em}
.program__link:hover{background:rgba(245,240,148,.15)}
.card--empty{color:var(--muted);text-align:center;padding:14px;border:1px dashed rgba(255,255,255,.3)}
.footer-line{border-top:1px solid rgba(255,255,255,.12);padding-top:6px;font-size:11px;color:var(--muted);letter-spacing:.12em}
@media (max-width:720px){
  body{padding:12px}
  .screen{aspect-ratio:auto;min-height:0}
  .masthead__title{font-size:15px}
}
</style>
</head>
<body>
<div class="bezel">
  <div class="screen">
    <header class="masthead">
      <div class="masthead__title">A — ALPHA WORKSPACE <span>READY</span></div>
      <div class="masthead__meta">MULTI-PROGRAM DIRECTORY · PURE HTML5 · SHARED CODE AT /SHARED/VX</div>
      <div class="status-line">DISPLAY MODE: COMMODORE-LIKE TEXT · ASPECT 19:6 WIDE</div>
    </header>
    <section class="controls">
      <nav class="menu" id="status-menu" aria-label="Filter projects by status"></nav>
      <label class="search"><span>SEARCH</span><input id="q" placeholder="TYPE TO FILTER"></label>
    </section>
    <main id="grid" role="list"></main>
    <div class="footer-line">VERSION V0.1.0 · EDIT HEADER BLOCK TO BUMP</div>
  </div>
</div>

<script id="embedded-projects" type="application/json" data-source="projects.json">
[
  {
    "slug": "hello",
    "title": "Hello App",
    "description": "Tiny sample mini-app to prove the hub works.",
    "tags": ["sample", "starter"],
    "status": "alpha",
    "path": "apps/hello/index.html",
    "shared": "v1",
    "updated": "2025-11-04"
  },
  {
    "slug": "sdf-tunnel",
    "title": "SDF Neon Tunnel",
    "description": "WebGL ray-marched neon tunnel (SDF) with soft shadows and glow.",
    "tags": ["webgl","sdf","raymarch","demoscene"],
    "status": "alpha",
    "path": "apps/sdf-tunnel/index.html",
    "shared": "v1",
    "updated": "2025-11-06"
  },
  {
    "slug": "hills-forest",
    "title": "Hills & Forest",
    "description": "Meters-true grassy hills with instanced trees and free-flight camera.",
    "tags": ["threejs","terrain","trees","freefly"],
    "status": "alpha",
    "path": "apps/hills-forest/index.html",
    "shared": "v1",
    "updated": "2025-11-06"
  },
  {
    "slug": "relax",
    "title": "Relaxation Affirmations",
    "description": "Multilingual affirmation deck with autoplay TTS and gentle ambience.",
    "tags": ["wellness","audio","multilingual"],
    "status": "alpha",
    "path": "apps/relax/index.html",
    "shared": "v1",
    "updated": "2025-11-07"
  },
  {
    "slug": "code-forge",
    "title": "Code Forge SplitMerge",
    "description": "Local-first tool to split merged AI code blocks into files and merge directories back to text.",
    "tags": ["fs-access","productivity","ai"],
    "status": "alpha",
    "path": "apps/code-forge/index.html",
    "shared": "none",
    "updated": "2025-11-07"
  }
]
</script>

<script type="module">
const grid = document.querySelector('#grid');
const q = document.querySelector('#q');
const menu = document.querySelector('#status-menu');
let activeStatus = 'all';

function readEmbeddedProjects(){
  const el = document.querySelector('#embedded-projects');
  if(!el) return null;
  try{
    const text = (el.textContent || '').trim();
    if(!text) return null;
    const data = JSON.parse(text);
    if(Array.isArray(data)) return data;
  }catch(err){
    console.warn('Embedded projects.json payload invalid', err);
  }
  return null;
}

async function getProjects(){
  const embedded = readEmbeddedProjects();
  if(location.protocol === 'file:' && embedded){
    console.info('Detected file:// usage; loading projects from embedded JSON payload.');
    return embedded;
  }
  try{
    const r = await fetch('projects.json', {cache:'no-store'});
    if(!r.ok) throw new Error(String(r.status));
    return await r.json();
  }catch(e){
    if(embedded){
      console.warn('projects.json unavailable; falling back to embedded payload', e);
      return embedded;
    }
    console.warn('projects.json unavailable; using empty list', e);
    return [];
  }
}

function render(items, needle='', status='all'){
  const n = (needle||'').trim().toLowerCase();
  const s = (status||'all').toLowerCase();
  grid.innerHTML='';
  for(const p of items){
    const hay = (p.title+' '+(p.tags||[]).join(' ')).toLowerCase();
    const itemStatus = (p.status||'unknown').toLowerCase();
    if(n && !hay.includes(n)) continue;
    if(s !== 'all' && itemStatus !== s) continue;
    const program = document.createElement('article');
    program.className='program';
    program.setAttribute('role','listitem');
    const tags = (p.tags||[]).map(t=>`<span>${t}</span>`).join(' ');
    program.innerHTML = `
      <div class="program__header">
        <span>${p.title}</span>
        <span>[${(p.status||'wip').toUpperCase()}]</span>
      </div>
      <div class="program__meta">#${p.slug||'unknown'} · PATH ${p.path||'—'} · SHARED ${p.shared||'v1'} · UPDATED ${p.updated||'—'}</div>
      <div class="program__desc">${p.description||'No description available.'}</div>
      <div class="program__tags">${tags}</div>
      <a class="program__link" href="${p.path}" target="_blank" rel="noopener">RUN PROGRAM</a>`;
    grid.appendChild(program);
  }
  if(!grid.children.length){
    const empty = document.createElement('div');
    empty.className='card--empty';
    empty.innerHTML = 'No projects match yet — try another keyword or status.';
    grid.appendChild(empty);
  }
}

function buildMenu(items){
  if(!menu) return;
  const statuses = Array.from(new Set(items.map(p=>(p.status||'unknown').toLowerCase()))).sort();
  const options = ['all',...statuses];
  menu.innerHTML = options.map(status=>{
    const label = status==='all' ? 'All projects' : status.replace(/(^|\s)\w/g,ch=>ch.toUpperCase());
    const activeClass = status===activeStatus ? ' is-active' : '';
    return `<button class="menu__item${activeClass}" type="button" data-filter="${status}">${label}</button>`;
  }).join('');
  menu.querySelectorAll('.menu__item').forEach(btn=>{
    btn.addEventListener('click',()=>{
      activeStatus = btn.dataset.filter;
      menu.querySelectorAll('.menu__item').forEach(el=>el.classList.toggle('is-active',el===btn));
      render(items, q.value, activeStatus);
    });
  });
}

getProjects().then(items=>{
  buildMenu(items);
  render(items, '', activeStatus);
  q.addEventListener('input', e=>render(items, e.target.value, activeStatus));
});
</script>
</body>
</html>
